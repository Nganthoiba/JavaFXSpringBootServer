<!DOCTYPE html>
<html>
	<head>
		<title>eSign Upload</title>
		
		<link rel="stylesheet" th:href="@{/css/bootstrap.css}" />
		<link rel="stylesheet" th:href="@{/css/style.css}" />
	</head>
	<body>
	 	<h3 class="text-center">Upload PDF File to be Digitally Signed</h3>
	  
		<div class="row">
			<div class="col-sm-5">
				<form action="/uploadPDFtoEsign" method="POST" enctype="multipart/form-data"  name="esignPdfForm">
				      <div class="form-group">
				        <label for="file">Select file to upload:</label>
				        <input type="file" id="file" name="my_file" accept=".pdf" required />
				      </div>
				      <div class="form-group">
				        <label>Set coordinates for signature:</label>
				        <div class="d-flex justify-content-between">
				          <div class="d-flex">
				            <label for="x">X:</label>
				            <input type="number" id="x" name="x" value="360"/>
				          </div>
				          <div class="d-flex">
				            <label for="y">Y:</label>
				            <input type="number" id="y" name="y" value="30"/>
				          </div>
				        </div>
				      </div>
				      <div class="form-group">
				        <label for="location">Location:</label>
				        <input type="text" id="location" name="location" />
				      </div>
				      <button type="submit">Upload & E-Sign</button>
				</form>
			</div>
			<div class="col-sm-7" id="serverResponse"></div>
		  </div>
		  
		  <script>
		  	var esignPdfForm = document.forms['esignPdfForm'];
		    esignPdfForm.onsubmit = async function(event) {
	        	event.preventDefault();

	        	const formData = new FormData(esignPdfForm);

	            try {
	                  const response = await fetch(esignPdfForm.action, {
	                      method: "POST",
	                      body: formData,
	                      headers: {
	                          'Accept': 'application/json'
	                      }
	                  });

	                  if (!response.ok) {
	                      const responseData = await response.json();
	                      throw new Error(responseData.message || "An error occurred");
	                  }

	                  // Get the PDF as a Blob
	                  const pdfBlob = await response.blob();

	                  // Create a URL for the Blob
	                  const pdfUrl = URL.createObjectURL(pdfBlob);

	                  // Embed the PDF in an iframe
	                  const iframe = document.createElement('iframe');
	                  iframe.src = pdfUrl;
	                  iframe.width = "100%";
	                  iframe.height = "600px";
	                  document.querySelector("#serverResponse").innerHTML = ""; // Clear previous content
	                  document.querySelector("#serverResponse").appendChild(iframe);
	              } catch (error) {
	                  console.error("Error in client-side request:", error);
	                  alert(error.message); // Display the error message to the user
	              }
	          };
	      </script>  	
	</body>
</html>
